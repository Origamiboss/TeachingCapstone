extends layout

block toolbar
        a(id="back", href="/frontPage") Back
        a(id="sign", href="/login") Log In

block content
    div(class="login")
        div
            label Username:
            input(type="text", id="username")
        div
            label Password:
            input(type="password", id="password")
        div
            label Rewrite Password:
            input(type="password", id="repassword")
        div
            label Teacher
            input(id="teacherBox", type="checkbox", checked)
            label Student
            input(id="studentBox", type="checkbox")
        button(id="SubmitButton", type="submit") Sign Up
        div(id="error", class="error", style="visibility: hidden;")
            p(id="errorText") a

    script.
        $(document).ready(function () {
            $('#SubmitButton').click(function (event) {
                // Get values from inputs
                var username = $('#username').val();
                var password = $('#password').val();
                var repassword = $('#repassword').val();
                var role;
                var validEntry = true;
                setErrorText("");
                if (repassword != password) {
                    setErrorText("Password must be written twice");
                    validEntry = false;
                }
                
                if ($("#studentBox").prop('checked')) {
                    role = "student";
                } else if ($("#teacherBox").prop('checked')) {
                    role = "teacher";
                } else {
                    setErrorText("Select if the account is a teacher or student");
                    validEntry = false;
                }
                // Display an alert with the values
                if (validEntry) {
                   event.preventDefault();
                    

                    // Send the data to the server via a POST request
                    fetch('/signUp/createAccount-click', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ username, password, role })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            setErrorText(data.error);
                        } else {
                            //go to main page becuase of succesful login
                            window.location.href = '/mainPage.html';
                        }
                    })
                    .catch(error => {
                        setErrorText(error);
                    });
                }
            });
            $('#teacherBox').change(function (event) {
                //change student box to null
                if ($(this).prop('checked')) {
                    $('#studentBox').prop('checked', false);
                }
            });
            $('#studentBox').change(function (event) {
                //change student box to null
                if ($(this).prop('checked')) {
                    $('#teacherBox').prop('checked', false);
                }
            });
        });
        var setErrorText = function (text) {
            document.getElementById("errorText").innerText = text;
            if (text == "") {
                document.getElementById("error").style.visibility = "hidden";
            } else {
                document.getElementById("error").style.visibility = "visible";
            }
        };

